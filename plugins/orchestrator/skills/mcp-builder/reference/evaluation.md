# MCP 서버 평가 가이드

## 개요

이 문서는 MCP 서버를 위한 포괄적인 평가 생성에 대한 안내를 제공한다. 평가는 LLM이 제공된 도구만 사용하여 MCP 서버를 효과적으로 사용하여 현실적이고 복잡한 질문에 답할 수 있는지 테스트한다.

---

## 빠른 참조

### 평가 요구사항
- 사람이 읽을 수 있는 10개의 질문 생성
- 질문은 읽기 전용, 독립적, 비파괴적이어야 함
- 각 질문은 여러 도구 호출 필요 (잠재적으로 수십 개)
- 답변은 단일하고 검증 가능한 값이어야 함
- 답변은 안정적이어야 함 (시간이 지나도 변하지 않음)

### 출력 형식
```xml
<evaluation>
   <qa_pair>
      <question>여기에 질문</question>
      <answer>단일 검증 가능한 답변</answer>
   </qa_pair>
</evaluation>
```

---

## 평가의 목적

MCP 서버 품질의 척도는 서버가 도구를 얼마나 잘 또는 포괄적으로 구현하는지가 아니라, 이러한 구현(입력/출력 스키마, 독스트링/설명, 기능)이 다른 컨텍스트 없이 MCP 서버에만 접근하는 LLM이 현실적이고 어려운 질문에 답하는 것을 얼마나 잘 가능하게 하는지다.

## 평가 개요

읽기 전용, 독립적, 비파괴적, 멱등 작업만으로 답할 수 있는 10개의 사람이 읽을 수 있는 질문을 생성한다. 각 질문은:
- 현실적
- 명확하고 간결
- 모호하지 않음
- 복잡하여 잠재적으로 수십 개의 도구 호출이나 단계 필요
- 미리 식별한 단일하고 검증 가능한 값으로 답할 수 있음

## 질문 가이드라인

### 핵심 요구사항

1. **질문은 독립적이어야 함**
   - 각 질문은 다른 질문의 답변에 의존하면 안 됨
   - 다른 질문 처리의 이전 쓰기 작업을 가정하면 안 됨

2. **질문은 비파괴적이고 멱등한 도구 사용만 필요**
   - 올바른 답변에 도달하기 위해 상태 수정을 지시하거나 요구하면 안 됨

3. **질문은 현실적, 명확, 간결, 복잡해야 함**
   - 다른 LLM이 답하기 위해 여러 (잠재적으로 수십 개의) 도구나 단계를 사용해야 함

### 복잡성과 깊이

4. **질문은 깊은 탐색 필요**
   - 여러 하위 질문과 순차적 도구 호출이 필요한 다중 홉 질문 고려
   - 각 단계는 이전 질문에서 찾은 정보에서 이점을 얻어야 함

5. **질문은 광범위한 페이징 필요할 수 있음**
   - 여러 페이지의 결과를 페이징해야 할 수 있음
   - 틈새 정보를 찾기 위해 오래된 데이터 (1-2년 전) 쿼리 필요
   - 질문은 어려워야 함

6. **질문은 깊은 이해 필요**
   - 표면적 지식이 아닌 깊은 이해
   - 증거가 필요한 참/거짓 질문으로 복잡한 아이디어 제시 가능
   - LLM이 다른 가설을 검색해야 하는 객관식 형식 사용 가능

7. **질문은 단순한 키워드 검색으로 해결 불가**
   - 대상 콘텐츠의 특정 키워드 포함 금지
   - 동의어, 관련 개념, 패러프레이즈 사용
   - 여러 검색, 여러 관련 항목 분석, 컨텍스트 추출, 그런 다음 답변 도출 필요

### 도구 테스트

8. **질문은 도구 반환 값을 스트레스 테스트해야 함**
   - 도구가 큰 JSON 객체나 목록을 반환하여 LLM을 압도할 수 있음
   - 여러 양식의 데이터 이해 필요:
     - ID와 이름
     - 타임스탬프와 날짜/시간 (월, 일, 년, 초)
     - 파일 ID, 이름, 확장자, MIME 타입
     - URL, GID 등
   - 도구가 모든 유용한 형태의 데이터를 반환하는 능력 테스트

9. **질문은 대부분 실제 인간 사용 사례 반영**
   - LLM의 도움을 받는 인간이 관심 가질 정보 검색 작업 종류

10. **질문은 수십 개의 도구 호출 필요할 수 있음**
    - 제한된 컨텍스트를 가진 LLM에 도전
    - MCP 서버 도구가 반환하는 정보를 줄이도록 장려

### 안정성

11. **질문은 답변이 변하지 않도록 설계**
    - 동적인 "현재 상태"에 의존하는 질문 금지
    - 예를 들어, 다음은 세지 않음:
      - 게시물에 대한 반응 수
      - 스레드에 대한 답글 수
      - 채널의 멤버 수

12. **MCP 서버가 생성하는 질문 종류를 제한하게 하지 않음**
    - 도전적이고 복잡한 질문 생성
    - 일부는 사용 가능한 MCP 서버 도구로 해결 불가능할 수 있음
    - 질문은 특정 출력 형식 필요할 수 있음 (날짜/시간 vs. epoch 시간, JSON vs. MARKDOWN)

## 답변 가이드라인

### 검증

1. **답변은 직접 문자열 비교로 검증 가능해야 함**
   - 답변이 여러 형식으로 다시 쓸 수 있으면, 질문에서 출력 형식 명확히 지정
   - 예: "YYYY/MM/DD 사용.", "True 또는 False로 응답.", "A, B, C, D만 답하시오."
   - 답변은 단일 검증 가능한 값이어야 함:
     - 사용자 ID, 사용자 이름, 표시 이름, 이름, 성
     - 채널 ID, 채널 이름
     - 메시지 ID, 문자열
     - URL, 제목
     - 수량
     - 타임스탬프, 날짜/시간
     - 부울 (참/거짓 질문용)
     - 이메일 주소, 전화번호
     - 파일 ID, 파일 이름, 파일 확장자
     - 객관식 답변
   - 답변은 특수 서식이나 복잡한 구조화된 출력 필요 없음
   - 직접 문자열 비교로 답변 검증

### 가독성

2. **답변은 일반적으로 사람이 읽을 수 있는 형식 선호**
   - 예: 이름, 이름, 성, 날짜/시간, 파일 이름, 메시지 문자열, URL, yes/no, true/false, a/b/c/d
   - 불투명한 ID보다 (ID도 허용)
   - 대부분의 답변은 사람이 읽을 수 있어야 함

### 안정성

3. **답변은 안정적/정상이어야 함**
   - 오래된 콘텐츠 확인 (예: 끝난 대화, 출시된 프로젝트, 답변된 질문)
   - 항상 같은 답변을 반환하는 "닫힌" 개념 기반 질문 생성
   - 질문이 비정상 답변을 방지하기 위해 고정된 시간 창 고려 요청 가능
   - 변경되지 않을 컨텍스트에 의존
   - 예: 논문 이름 찾을 때, 나중에 출판된 논문과 혼동되지 않도록 충분히 구체적

4. **답변은 명확하고 모호하지 않아야 함**
   - 질문은 단일하고 명확한 답변이 있도록 설계
   - MCP 서버 도구 사용으로 답변 도출 가능

### 다양성

5. **답변은 다양해야 함**
   - 답변은 다양한 양식과 형식의 단일 검증 가능한 값
   - 사용자 개념: 사용자 ID, 사용자 이름, 표시 이름, 이름, 성, 이메일 주소, 전화번호
   - 채널 개념: 채널 ID, 채널 이름, 채널 주제
   - 메시지 개념: 메시지 ID, 메시지 문자열, 타임스탬프, 월, 일, 년

6. **답변은 복잡한 구조이면 안 됨**
   - 값 목록 아님
   - 복잡한 객체 아님
   - ID나 문자열 목록 아님
   - 자연어 텍스트 아님
   - 단, 직접 문자열 비교로 직관적으로 검증 가능하고
   - 현실적으로 재현 가능한 경우 제외
   - LLM이 같은 목록을 다른 순서나 형식으로 반환할 가능성 낮아야 함

## 평가 프로세스

### 1단계: 문서 검사

대상 API의 문서를 읽어 이해:
- 사용 가능한 엔드포인트와 기능
- 모호함이 있으면, 웹에서 추가 정보 가져오기
- 이 단계를 가능한 한 병렬화
- 각 서브에이전트가 파일 시스템이나 웹의 문서만 검토하도록 보장

### 2단계: 도구 검사

MCP 서버에서 사용 가능한 도구 나열:
- MCP 서버 직접 검사
- 입력/출력 스키마, 독스트링, 설명 이해
- 이 단계에서 도구 자체를 호출하지 않음

### 3단계: 이해 개발

1단계와 2단계를 좋은 이해가 될 때까지 반복:
- 여러 번 반복
- 생성하려는 작업 종류에 대해 생각
- 이해 개선
- 어떤 단계에서도 MCP 서버 구현 코드 자체를 읽지 않음
- 직관과 이해를 사용하여 합리적이고 현실적이지만 매우 도전적인 작업 생성

### 4단계: 읽기 전용 콘텐츠 검사

API와 도구를 이해한 후, MCP 서버 도구 사용:
- 읽기 전용 및 비파괴적 작업만 사용하여 콘텐츠 검사
- 목표: 현실적인 질문 생성을 위한 특정 콘텐츠 식별 (예: 사용자, 채널, 메시지, 프로젝트, 작업)
- 상태를 수정하는 도구 호출 금지
- MCP 서버 구현 코드 자체 읽지 않음
- 개별 서브에이전트가 독립적인 탐색을 추구하도록 이 단계 병렬화
- 각 서브에이전트가 읽기 전용, 비파괴적, 멱등 작업만 수행하도록 보장
- 주의: 일부 도구가 컨텍스트를 소진시키는 많은 데이터 반환 가능
- 탐색을 위해 점진적이고 작고 타겟팅된 도구 호출 수행
- 모든 도구 호출 요청에서 `limit` 매개변수를 사용하여 결과 제한 (<10)
- 페이지네이션 사용

### 5단계: 작업 생성

콘텐츠 검사 후, 10개의 사람이 읽을 수 있는 질문 생성:
- LLM이 MCP 서버로 이에 답할 수 있어야 함
- 위의 모든 질문 및 답변 가이드라인 따르기

## 출력 형식

각 QA 쌍은 질문과 답변으로 구성된다. 출력은 다음 구조의 XML 파일이어야 한다:

```xml
<evaluation>
   <qa_pair>
      <question>Q2 2024에 생성된 완료된 작업이 가장 많은 프로젝트를 찾으시오. 프로젝트 이름은 무엇입니까?</question>
      <answer>Website Redesign</answer>
   </qa_pair>
   <qa_pair>
      <question>2024년 3월에 닫힌 "bug" 라벨 이슈를 검색하시오. 어떤 사용자가 가장 많은 이슈를 닫았습니까? 사용자 이름을 제공하시오.</question>
      <answer>sarah_dev</answer>
   </qa_pair>
</evaluation>
```

## 검증 프로세스

평가 생성 후:

1. **XML 파일 검토**하여 스키마 이해
2. **각 작업 지시 로드**하고 MCP 서버와 도구를 사용하여 병렬로 직접 작업을 풀어 올바른 답변 식별
3. **쓰기 또는 파괴적 작업이 필요한 작업 플래그**
4. **모든 올바른 답변 누적**하고 문서의 잘못된 답변 교체
5. **쓰기 또는 파괴적 작업이 필요한 `<qa_pair>` 제거**

컨텍스트 소진을 피하기 위해 작업 풀이를 병렬화한 다음, 모든 답변을 누적하고 마지막에 파일에 변경 수행.

## 고품질 평가 생성 팁

1. **작업 생성 전에 깊이 생각하고 계획**
2. **기회가 있을 때 병렬화**하여 프로세스 가속화 및 컨텍스트 관리
3. **현실적인 사용 사례에 집중** - 인간이 실제로 달성하고 싶어하는 것
4. **도전적인 질문 생성** - MCP 서버 기능의 한계 테스트
5. **안정성 보장** - 역사적 데이터와 닫힌 개념 사용
6. **답변 검증** - MCP 서버 도구를 사용하여 직접 질문 풀기
7. **프로세스 중 학습한 내용 기반 반복 및 개선**
